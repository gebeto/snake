!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=18)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.default="black",this.colors=[null,"red","purple","green","blue"]}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.getColor=function(t){var e=this.colors[t];return e||this.default},t.prototype.getColorIndex=function(t){return this.colors.indexOf(t.toLowerCase())},t}();e.Colors=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WIDTH=12,e.HEIGHT=20,e.PIXEL_SIZE=20,e.BACKGROUND_COLOR="#000000",e.SHAPE_COLOR="#FF00FF"},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var a=o(r(1));e.ScaleDecorator=function(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.draw=function(e,r){e.scale(a.PIXEL_SIZE,a.PIXEL_SIZE),t.prototype.draw.call(this,e,r),e.scale(1/a.PIXEL_SIZE,1/a.PIXEL_SIZE)},e}(t)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,r){this.width=t,this.height=e,this.grid=[],this.fillGrid(r)}return t.prototype.fillGrid=function(t){for(var e=0;e<this.height;e++){var r=new Array(this.width);t?this.grid.push(t[e]):(r.fill(0),this.grid.push(r))}},t.prototype.coalesced=function(t,e,r){for(var n=0;n<t.grid.length;n++)for(var i=0;i<t.grid[n].length;i++)if(t.grid[n][i]&&this.grid[r+n][e+i])return!0;return!1},t.prototype.merge=function(t,e,r){for(var n=0;n<t.grid.length;n++)for(var i=0;i<t.grid[n].length;i++)t.grid[n][i]&&(this.grid[r+n][e+i]=t.grid[n][i])},t.prototype.rotate=function(t){for(var e,r=0;r<this.grid.length;r++)for(var n=0;n<r;n++)e=[this.grid[r][n],this.grid[n][r]],this.grid[n][r]=e[0],this.grid[r][n]=e[1];t>0?this.grid.forEach(function(t){return t.reverse()}):this.grid.reverse()},t.prototype.clear=function(){this.grid.map(function(t){t.fill(0)})},t}();e.Matrix=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,i=r(16),o=r(10),a=r(8);!function(t){t[t.menu=0]="menu",t[t.play=1]="play",t[t.pause=2]="pause"}(n=e.GAME_STATE||(e.GAME_STATE={}));var s=function(){function t(){this.gameMenu=new o.GameMenu,this.gamePlay=new i.GamePlay,this.gamePause=new a.GamePause,this.setState(n.menu)}return t.prototype.getState=function(){return this.state},t.prototype.setState=function(t){t==n.menu?this._setState(this.gameMenu):t==n.play?this._setState(this.gamePlay):t==n.pause&&this._setState(this.gamePause)},t.prototype._setState=function(t){this.state&&this.state.unmount&&this.state.unmount(),this.state=t,this.state&&this.state.mount&&this.state.mount()},t}();e.GameState=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.actions=[]}return t.getInstance=function(){return this.instance||(this.instance=new t,this.instance.loop()),this.instance},t.prototype.appendAction=function(t){this.actions.push(t)},t.prototype.loop=function(t){void 0===t&&(t=0),this.actions.forEach(function(e){e(t)}),requestAnimationFrame(this.loop.bind(this))},t}();e.AnimationLoop=n},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(1)),o=r(5),a=function(){function t(){this.layers=[],this.animationLoop=o.AnimationLoop.getInstance(),this.animationLoop.appendAction(this.draw.bind(this)),this.canvas=document.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=i.WIDTH*i.PIXEL_SIZE,this.canvas.height=i.HEIGHT*i.PIXEL_SIZE,this.canvas.style.backgroundColor=i.BACKGROUND_COLOR,this.canvas.style.height=i.HEIGHT*i.PIXEL_SIZE+"px",this.canvas.style.width=i.WIDTH*i.PIXEL_SIZE+"px",window.CTX=this.ctx}return t.prototype.append=function(t){this.layers.push(t)},t.prototype.draw=function(t){var e=this;this.ctx.clearRect(0,0,i.WIDTH*i.PIXEL_SIZE,i.HEIGHT*i.PIXEL_SIZE),this.layers.forEach(function(r){r.draw(e.ctx,t)})},t}();e.Scene=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.mount=function(){console.log("MOUNT",this)},t.prototype.unmount=function(){console.log("UNMOUNT",this)},t.prototype.draw=function(t){t.fillStyle="black",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle="white",t.textAlign="center",t.font="40px Arial",t.fillText("Paused",t.canvas.width/2,t.canvas.height/2),t.font="24px Arial",t.fillText("Resume",t.canvas.width/2,t.canvas.height/2+40),t.fillText("Exit",t.canvas.width/2,t.canvas.height/2+80)},t}();e.GamePause=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(7);e.GamePause=n.GamePause},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.mount=function(){console.log("MOUNT",this)},t.prototype.unmount=function(){console.log("UNMOUNT",this)},t.prototype.draw=function(t){var e=t.canvas.width,r=t.canvas.height;t.fillStyle="black",t.fillRect(0,0,e,r),t.textAlign="center",t.font="40px Arial",t.fillStyle="white",t.fillText("TETRIS",e/2,r/10+20),t.font="25px Arial",t.fillText("Play",e/2,r/2),t.font="20px Arial",t.fillText("Leaderboard",e/2,r/2+40)},t}();e.GameMenu=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9);e.GameMenu=n.GameMenu},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){var t=this;this.handlers={},document.addEventListener("keydown",function(e){65===e.keyCode?t.dispatchEvent("left",1):68===e.keyCode?t.dispatchEvent("right",1):87===e.keyCode?t.dispatchEvent("up",1):83===e.keyCode?t.dispatchEvent("down",1):81===e.keyCode?t.dispatchEvent("rotate",-1):69===e.keyCode&&t.dispatchEvent("rotate",1)})}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.addEventListener=function(t,e){this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push(e)},t.prototype.dispatchEvent=function(t,e){console.log(t,e),this.handlers[t]&&this.handlers[t].forEach(function(t){return t(e)})},t}();e.Manipulator=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(2),o=function(){function t(t,e,r,i,o,a){this.colors=n.Colors.getInstance(),this.x=e,this.y=r,this.width=i,this.height=o,this.matrix=a}return t.prototype.draw=function(t,e){var r=this;this.matrix.grid.forEach(function(e,n){e.forEach(function(e,i){e&&(t.fillStyle=r.colors.getColor(e),t.fillRect(r.x+i,r.y+n,1,1))})})},t}();e.BasicBasicShape=o,e.BasicShape=i.ScaleDecorator(o)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(12),i=r(3),o=r(0),a=function(){function t(){this.shapeParams=this.reset(),this.colors=o.Colors.getInstance()}return t.prototype.reset=function(){return this.shapeParams={color:"white",x:0,y:0,rows:[]}},t.prototype.setColor=function(t){return this.shapeParams.color=t,this},t.prototype.setX=function(t){return this.shapeParams.x=t,this},t.prototype.setY=function(t){return this.shapeParams.y=t,this},t.prototype.addRow=function(t){return this.shapeParams.rows.push(t),this},t.prototype.getResult=function(){var t=this,e=this.shapeParams.rows;e.forEach(function(e){e.forEach(function(r,n){e[n]=e[n]?t.colors.getColorIndex(t.shapeParams.color):e[n]})});var r=e.length;for(e.forEach(function(t){t.length>r&&(r=t.length)});e.length<r;){var o=new Array(r);o.fill(0),e.push(o)}var a=new i.Matrix(r,r,e),s=new n.BasicShape(this.shapeParams.color,this.shapeParams.x,this.shapeParams.y,r,r,a);return this.reset(),s},t}();e.ShapeBuilder=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(13),i=function(){function t(){this.shapeBuilder=new n.ShapeBuilder}return t.prototype.createRandomShape=function(){var t=[this.createTShape,this.createOShape,this.createSShape,this.createZShape];return t[Math.random()*t.length|0].call(this)},t.prototype.createOShape=function(){return this.shapeBuilder.setColor("purple").addRow([1,1]).addRow([1,1]).getResult()},t.prototype.createTShape=function(){return this.shapeBuilder.setColor("green").addRow([1,1,1]).addRow([0,1,0]).getResult()},t.prototype.createSShape=function(){return this.shapeBuilder.setColor("blue").addRow([0,1,1]).addRow([1,1,0]).getResult()},t.prototype.createZShape=function(){return this.shapeBuilder.setColor("red").addRow([1,1,0]).addRow([0,1,1]).getResult()},t}();e.ShapeFactory=i},function(t,e,r){"use strict";var n=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(1)),o=r(3),a=r(0),s=r(2),u=function(){function t(){this.colors=a.Colors.getInstance(),this.matrix=new o.Matrix(i.WIDTH,i.HEIGHT),this.matrix.grid.push(new Array(i.WIDTH)),this.matrix.grid[this.matrix.grid.length-1].fill(1)}return t.prototype.draw=function(t){var e=this;this.matrix.grid.forEach(function(r,n){r.forEach(function(r,i){r&&(t.fillStyle=e.colors.getColor(r),t.fillRect(i,n,1,1))})})},t.prototype.coalesced=function(t){return this.matrix.coalesced(t.matrix,t.x,t.y+1)},t.prototype.merge=function(t){this.matrix.merge(t.matrix,t.x,t.y)},t.prototype.clear=function(){this.matrix.clear(),this.matrix.grid[this.matrix.grid.length-1].fill(1)},t}();e.BaseArea=u,e.Area=s.ScaleDecorator(u)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(15),i=r(14),o=r(11),a=new i.ShapeFactory,s=function(){function t(){var t=this;this.prevTime=0,this.dropCounter=0,this.dropInterval=1e3,this.manipulator=o.Manipulator.getInstance(),this.area=new n.Area,this.currentShape=a.createTShape(),this.nextShape=a.createRandomShape(),this.manipulator.addEventListener("left",function(e){t.area.matrix.coalesced(t.currentShape.matrix,t.currentShape.x-1,t.currentShape.y)||(t.currentShape.x-=1)}),this.manipulator.addEventListener("right",function(e){t.area.matrix.coalesced(t.currentShape.matrix,t.currentShape.x+1,t.currentShape.y)||(t.currentShape.x+=1)}),this.manipulator.addEventListener("down",function(e){t.isColision(function(){return t.merge()}),t.currentShape.y+=1,t.dropCounter=0}),this.manipulator.addEventListener("rotate",function(e){t.currentShape.matrix.rotate(e),t.area.matrix.coalesced(t.currentShape.matrix,t.currentShape.x,t.currentShape.y)&&t.currentShape.matrix.rotate(-e)})}return t.prototype.isColision=function(t,e){var r=this.area.coalesced(this.currentShape);!r||1!==this.currentShape.y&&0!==this.currentShape.y||(this.area.clear(),r=!1);var n=r?t:e;return n&&n(),r},t.prototype.merge=function(){this.area.merge(this.currentShape),this.currentShape=this.nextShape,this.nextShape=a.createRandomShape()},t.prototype.draw=function(t,e){var r=this,n=e-this.prevTime;this.prevTime=e,this.dropCounter+=n,this.dropCounter>this.dropInterval&&this.isColision(function(){r.merge()},function(){r.currentShape.y++,r.dropCounter=0}),this.area.draw(t),this.currentShape.draw(t)},t}();e.GamePlay=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(4),i=r(4),o=function(){function t(){this.state=new n.GameState}return t.prototype.draw=function(t,e){this.state.getState().draw(t,e)},t.prototype.enterMenu=function(){this.state.setState(i.GAME_STATE.menu)},t.prototype.enterPlay=function(){this.state.setState(i.GAME_STATE.play)},t.prototype.enterPause=function(){this.state.setState(i.GAME_STATE.pause)},t}();e.Game=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(17),i=r(6);document.addEventListener("DOMContentLoaded",function(){var t=new n.Game;(new i.Scene).append(t),window.GAME=t})}]);